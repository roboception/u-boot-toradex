
altbootcmd=run mender_altbootcmd; run bootcmd
arch=arm
baudrate=115200
blink_blue=i2c mw 0x32 0x01 08 1
blink_disable=i2c mw 0x32 0x01 00 1
blink_green=i2c mw 0x32 0x01 20 1
blink_init=i2c dev 1
blink_red=i2c mw 0x32 0x01 02 1
blink_white=i2c mw 0x32 0x01 2a 1
board=apalis-tk1
board_name=apalis-tk1
boot_a_script=load ${devtype} ${devnum}:${distro_bootpart} ${scriptaddr} ${prefix}${script}; source ${scriptaddr}
bootcmd_dhcp=run boot_net_usb_start; run boot_net_pci_enum; if dhcp ${scriptaddr} ${boot_script_dhcp}; then source ${scriptaddr}; fi;
bootcmd_mmc0=setenv devnum 0; run mmc_boot
bootcmd_mmc1=setenv devnum 1; run mmc_boot
bootcmd_pxe=run boot_net_usb_start; run boot_net_pci_enum; dhcp; if pxe get; then pxe boot; fi
bootcmd=run bootseq
bootcmd_usb0=setenv devnum 0; run usb_boot
bootcount=0
bootdelay=1
boot_extlinux=sysboot ${devtype} ${devnum}:${distro_bootpart} any ${scriptaddr} ${prefix}extlinux/extlinux.conf
boot_file=boot/uImage
bootlimit=1
boot_net_pci_enum=pci enum
boot_net_usb_start=usb start
boot_prefixes=/ /boot/
boot_script_dhcp=boot.scr.uimg
boot_scripts=boot.scr.uimg boot.scr
bootseq=run setup; run setup_mender; run pinupdate; run chkbootable; if test ${linuxbootable} = 1; then run emmcboot; else run switchpart; run chkbootable; if test ${linuxbootable} = 1; then run emmcboot; else run setethupdate; fi; fi;
boot_targets=mmc1 mmc0 usb0 pxe dhcp 
chkbootable=run chkdtb; run chkkernel; if test ${dtbloaded} = 1 && test ${kernelloaded} = 1;then setenv linuxbootable 1; else setenv linuxbootable 0; echo Linux not bootable from ${mender_uboot_root}; fi;
chkdtb=if load ${mender_uboot_root} ${fdt_addr_r} boot/${soc}-apalis-${fdt_board}.dtb; then setenv dtbloaded 1; else setenv dtbloaded 0; fi;
chkkernel=if load ${mender_uboot_root} ${kernel_addr_r} ${boot_file}; then setenv kernelloaded 1; else setenv kernelloaded 0; fi;
chkpin200=if gpio input A3; then echo 200 A3 low && false; else echo 200 A3 high && true; fi;
chkpin204=if gpio input A2; then echo 204 A2 low && false; else echo 204 A2 high && true; fi;
chkupdscr=if tftpboot ${loadaddr} flash_eth.img; then echo update script accessible && true; else echo update script not accessible && false; fi;
console=ttyS0
cpu=armv7
defargs=lp0_vec=2064@0xf46ff000 core_edp_mv=1150 core_edp_ma=4000 usb_port_owner_info=2 lane_owner_info=6 emc_max_dvfs=0 cma=256M panic=60
dfu_alt_info=apalis-tk1.img raw 0x0 0x500 mmcpart 1; boot part 0 1 mmcpart 0; rootfs part 0 2 mmcpart 0; uImage fat 0 1 mmcpart 0; tegra124-apalis-eval.dtb fat 0 1 mmcpart 0
disable_blue=i2c mw 0x32 17 00
disable_green=i2c mw 0x32 16 00
disable_red=i2c mw 0x32 1c 00
disable_white=run disable_red; run disable_green; run disable_blue;
distro_bootcmd=for target in ${boot_targets}; do run bootcmd_${target}; done
emmcargs=ip=off root=${mender_kernel_root} rw rootfstype=ext3 rootwait
emmcboot=setenv bootargs ${defargs} ${emmcargs} ${setupargs} ${vidargs}; run expand_bootargs; bootm ${kernel_addr_r} - ${fdt_addr_r}
emmcdtbload=setenv dtbparam; load ${mender_uboot_root} ${fdt_addr_r} boot/${soc}-apalis-${fdt_board}.dtb && setenv dtbparam ${fdt_addr_r}
enable_blue=i2c mw 0x32 17 ff
enable_green=i2c mw 0x32 16 ff
enable_red=i2c mw 0x32 1c ff
enable_white=run enable_red; run enable_green; run enable_blue;
expand_bootargs=setenv expand setenv emmcargs ${emmcargs};run expand; setenv expand setenv bootargs ${bootargs}; run expand; setenv expand;
fdt_addr_r=0x82000000
fdt_board=eval
fdt_fixup=;
fdt_high=ffffffff
initrd_high=ffffffff
ipaddr=192.168.10.2
kernel_addr_r=0x81000000
loadaddr=0x81000000
mender_altbootcmd=if test ${mender_boot_part} = 2; then setenv mender_boot_part 3; else setenv mender_boot_part 2; fi; setenv upgrade_available 0; saveenv; run mender_setup
mender_boot_part=2
mender_setup=setenv mender_kernel_root /dev/mmcblk0p${mender_boot_part}; setenv mender_uboot_root mmc 0:${mender_boot_part}; setenv expand_bootargs setenv bootargs ${bootargs}; run expand_bootargs; setenv expand_bootargs
mender_try_to_recover=if test ${upgrade_available} = 1; then reset; fi
mender_uboot_boot=mmc 0:1
mender_uboot_dev=0
mender_uboot_if=mmc
mmc_boot=if mmc dev ${devnum}; then setenv devtype mmc; run scan_dev_for_boot_part; fi
netmask=255.255.255.0
pinupdate=if run chkpin200 && run chkpin204 ; then echo update && run tftpupdate; else echo no update; fi;
pxefile_addr_r=0x90100000
ramdisk_addr_r=0x82100000
reload_defaults=env default -a; saveenv;
scan_dev_for_boot=echo Scanning ${devtype} ${devnum}:${distro_bootpart}...; for prefix in ${boot_prefixes}; do run scan_dev_for_extlinux; run scan_dev_for_scripts; done;
scan_dev_for_boot_part=part list ${devtype} ${devnum} -bootable devplist; env exists devplist || setenv devplist 1; for distro_bootpart in ${devplist}; do if fstype ${devtype} ${devnum}:${distro_bootpart} bootfstype; then run scan_dev_for_boot; fi; done
scan_dev_for_extlinux=if test -e ${devtype} ${devnum}:${distro_bootpart} ${prefix}extlinux/extlinux.conf; then echo Found ${prefix}extlinux/extlinux.conf; run boot_extlinux; echo SCRIPT FAILED: continuing...; fi
scan_dev_for_scripts=for script in ${boot_scripts}; do if test -e ${devtype} ${devnum}:${distro_bootpart} ${prefix}${script}; then echo Found U-Boot script ${prefix}${script}; run boot_a_script; echo SCRIPT FAILED: continuing...; fi; done
scriptaddr=0x90000000
serverip=192.168.10.1
setethupdate=if env exists ethaddr; then; else setenv ethaddr 00:14:2d:00:00:00; fi; pci enum && tftpboot ${loadaddr} flash_eth.img && source ${loadaddr}
setsdupdate=setenv interface mmc; setenv drive 1; mmc rescan; load ${interface} ${drive}:1 ${loadaddr} flash_blk.img || setenv drive 2; mmc rescan; load ${interface} ${drive}:1 ${loadaddr} flash_blk.img && source ${loadaddr}
setup_mender=setenv mender_kernel_root /dev/mmcblk0p${mender_boot_part}; setenv mender_uboot_root mmc 0:${mender_boot_part};
setup=setenv setupargs igb_mac=${ethaddr} consoleblank=0 no_console_suspend=1 console=tty1 console=${console},${baudrate}n8 debug_uartport=lsport,0 ${memargs}
soc=tegra124
stderr=serial
stdin=serial
stdout=serial
switchpart=if test ${mender_boot_part} = 2; then setenv mender_boot_part 3; echo Switching to partition B; else setenv mender_boot_part 2; echo Switching to partition A; fi; run setup_mender;
tftpconnect=setenv autoload false; if env exists ethaddr; then; else setenv ethaddr 00:14:2d:00:00:00; fi; pci enum;
tftp_connect_state=run blink_init; run blink_white; run tftpconnect; until run chkupdscr; do echo try to reconnect && run tftpconnect; done; run blink_disable;
tftpupdate=run blink_white; run tftp_connect_state; run disable_white; run enable_blue; run blink_blue; run setethupdate && run update && run blink_disable && run disable_blue && run enable_green && run blink_green && setenv bootcmd run reload_defaults && saveenv;
upgrade_available=0
usb_boot=usb start; if usb dev ${devnum}; then setenv devtype usb; run scan_dev_for_boot_part; fi
vendor=toradex
vidargs=video=tegrafb0:640x480-16@60 fbcon=map:1
